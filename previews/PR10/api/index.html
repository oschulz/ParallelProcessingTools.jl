<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>API · ParallelProcessingTools</title><meta name="title" content="API · ParallelProcessingTools"/><meta property="og:title" content="API · ParallelProcessingTools"/><meta property="twitter:title" content="API · ParallelProcessingTools"/><meta name="description" content="Documentation for ParallelProcessingTools."/><meta property="og:description" content="Documentation for ParallelProcessingTools."/><meta property="twitter:description" content="Documentation for ParallelProcessingTools."/><meta property="og:url" content="https://oschulz.github.io/ParallelProcessingTools.jl/stable/api/"/><meta property="twitter:url" content="https://oschulz.github.io/ParallelProcessingTools.jl/stable/api/"/><link rel="canonical" href="https://oschulz.github.io/ParallelProcessingTools.jl/stable/api/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">ParallelProcessingTools</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li class="is-active"><a class="tocitem" href>API</a><ul class="internal"><li><a class="tocitem" href="#Modules"><span>Modules</span></a></li><li><a class="tocitem" href="#Types-and-constants"><span>Types and constants</span></a></li><li><a class="tocitem" href="#Functions-and-macros"><span>Functions and macros</span></a></li><li class="toplevel"><a class="tocitem" href="#Documentation"><span>Documentation</span></a></li></ul></li><li><a class="tocitem" href="../LICENSE/">LICENSE</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>API</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>API</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/oschulz/ParallelProcessingTools.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/oschulz/ParallelProcessingTools.jl/blob/main/docs/src/api.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="API"><a class="docs-heading-anchor" href="#API">API</a><a id="API-1"></a><a class="docs-heading-anchor-permalink" href="#API" title="Permalink"></a></h1><h2 id="Modules"><a class="docs-heading-anchor" href="#Modules">Modules</a><a id="Modules-1"></a><a class="docs-heading-anchor-permalink" href="#Modules" title="Permalink"></a></h2><ul></ul><h2 id="Types-and-constants"><a class="docs-heading-anchor" href="#Types-and-constants">Types and constants</a><a id="Types-and-constants-1"></a><a class="docs-heading-anchor-permalink" href="#Types-and-constants" title="Permalink"></a></h2><ul><li><a href="#ParallelProcessingTools.AbstractThreadLocal"><code>ParallelProcessingTools.AbstractThreadLocal</code></a></li><li><a href="#ParallelProcessingTools.AddProcsMode"><code>ParallelProcessingTools.AddProcsMode</code></a></li><li><a href="#ParallelProcessingTools.ElasticAddProcsMode"><code>ParallelProcessingTools.ElasticAddProcsMode</code></a></li><li><a href="#ParallelProcessingTools.ExternalProcesses"><code>ParallelProcessingTools.ExternalProcesses</code></a></li><li><a href="#ParallelProcessingTools.LocalProcesses"><code>ParallelProcessingTools.LocalProcesses</code></a></li><li><a href="#ParallelProcessingTools.SlurmRun"><code>ParallelProcessingTools.SlurmRun</code></a></li><li><a href="#ParallelProcessingTools.ThreadLocal"><code>ParallelProcessingTools.ThreadLocal</code></a></li></ul><h2 id="Functions-and-macros"><a class="docs-heading-anchor" href="#Functions-and-macros">Functions and macros</a><a id="Functions-and-macros-1"></a><a class="docs-heading-anchor-permalink" href="#Functions-and-macros" title="Permalink"></a></h2><ul><li><a href="#ParallelProcessingTools.@always_everywhere-Tuple{Any}"><code>ParallelProcessingTools.@always_everywhere</code></a></li><li><a href="#ParallelProcessingTools.@critical-Tuple{Any}"><code>ParallelProcessingTools.@critical</code></a></li><li><a href="#ParallelProcessingTools.@mt_out_of_order-Tuple{Any}"><code>ParallelProcessingTools.@mt_out_of_order</code></a></li><li><a href="#ParallelProcessingTools.@onprocs-Tuple{Any, Any}"><code>ParallelProcessingTools.@onprocs</code></a></li><li><a href="#ParallelProcessingTools.@onthreads-Tuple{Any, Any}"><code>ParallelProcessingTools.@onthreads</code></a></li><li><a href="#ParallelProcessingTools.addworkers"><code>ParallelProcessingTools.addworkers</code></a></li><li><a href="#ParallelProcessingTools.allthreads-Tuple{}"><code>ParallelProcessingTools.allthreads</code></a></li><li><a href="#ParallelProcessingTools.default_elastic_manager"><code>ParallelProcessingTools.default_elastic_manager</code></a></li><li><a href="#ParallelProcessingTools.elastic_addprocs_timeout"><code>ParallelProcessingTools.elastic_addprocs_timeout</code></a></li><li><a href="#ParallelProcessingTools.elastic_localworker_startcmd-Tuple{Distributed.ClusterManager}"><code>ParallelProcessingTools.elastic_localworker_startcmd</code></a></li><li><a href="#ParallelProcessingTools.getallvalues"><code>ParallelProcessingTools.getallvalues</code></a></li><li><a href="#ParallelProcessingTools.getlocalvalue"><code>ParallelProcessingTools.getlocalvalue</code></a></li><li><a href="#ParallelProcessingTools.pinthreads_auto-Tuple{}"><code>ParallelProcessingTools.pinthreads_auto</code></a></li><li><a href="#ParallelProcessingTools.pinthreads_distributed-Tuple{AbstractVector{&lt;:Integer}}"><code>ParallelProcessingTools.pinthreads_distributed</code></a></li><li><a href="#ParallelProcessingTools.shutdown_workers_atexit-Tuple{}"><code>ParallelProcessingTools.shutdown_workers_atexit</code></a></li><li><a href="#ParallelProcessingTools.start_elastic_workers"><code>ParallelProcessingTools.start_elastic_workers</code></a></li><li><a href="#ParallelProcessingTools.worker_init_code"><code>ParallelProcessingTools.worker_init_code</code></a></li><li><a href="#ParallelProcessingTools.worker_resources-Tuple{}"><code>ParallelProcessingTools.worker_resources</code></a></li><li><a href="#ParallelProcessingTools.worker_start_command"><code>ParallelProcessingTools.worker_start_command</code></a></li><li><a href="#ParallelProcessingTools.workpart"><code>ParallelProcessingTools.workpart</code></a></li></ul><h1 id="Documentation"><a class="docs-heading-anchor" href="#Documentation">Documentation</a><a id="Documentation-1"></a><a class="docs-heading-anchor-permalink" href="#Documentation" title="Permalink"></a></h1><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ParallelProcessingTools.AbstractThreadLocal" href="#ParallelProcessingTools.AbstractThreadLocal"><code>ParallelProcessingTools.AbstractThreadLocal</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">abstract type AbstractThreadLocal{T} end</code></pre><p>Abstract type for thread-local values of type <code>T</code>.</p><p>The value for the current thread is accessed via <code>getindex(::AbstractThreadLocal)</code> and `setindex(::AbstractThreadLocal, x).</p><p>To access both regular and thread-local values in a unified manner, use the function <a href="#ParallelProcessingTools.getlocalvalue"><code>getlocalvalue</code></a>.</p><p>To get the all values across all threads, use the function <a href="#ParallelProcessingTools.getallvalues"><code>getallvalues</code></a>.</p><p>Default implementation is <a href="#ParallelProcessingTools.ThreadLocal"><code>ThreadLocal</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/oschulz/ParallelProcessingTools.jl/blob/a57f4d1a8fa601295f82851ae42b368ac94d15b2/src/threadlocal.jl#L4-L19">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ParallelProcessingTools.AddProcsMode" href="#ParallelProcessingTools.AddProcsMode"><code>ParallelProcessingTools.AddProcsMode</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">abstract type ParallelProcessingTools.AddProcsMode</code></pre><p>Abstract supertype for worker process addition modes.</p><p>Subtypes must implement:</p><ul><li><code>ParallelProcessingTools.addworkers(mode::SomeAddProcsMode)</code></li></ul><p>and may want to specialize:</p><ul><li><code>ParallelProcessingTools.worker_init_code(mode::SomeAddProcsMode)</code></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/oschulz/ParallelProcessingTools.jl/blob/a57f4d1a8fa601295f82851ae42b368ac94d15b2/src/addworkers.jl#L127-L139">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ParallelProcessingTools.ElasticAddProcsMode" href="#ParallelProcessingTools.ElasticAddProcsMode"><code>ParallelProcessingTools.ElasticAddProcsMode</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">abstract type ParallelProcessingTools.ElasticAddProcsMode &lt;: ParallelProcessingTools.AddProcsMode</code></pre><p>Abstract supertype for worker process addition modes that use the elastic cluster manager.</p><p>Subtypes must implement:</p><ul><li><code>ParallelProcessingTools.worker_start_command(mode::SomeElasticAddProcsMode, manager::ClusterManagers.ElasticManager)</code></li><li><code>ParallelProcessingTools.start_elastic_workers(mode::SomeElasticAddProcsMode, manager::ClusterManagers.ElasticManager)</code></li></ul><p>and may want to specialize:</p><ul><li><code>ParallelProcessingTools.elastic_addprocs_timeout(mode::SomeElasticAddProcsMode)</code></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/oschulz/ParallelProcessingTools.jl/blob/a57f4d1a8fa601295f82851ae42b368ac94d15b2/src/addworkers.jl#L280-L294">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ParallelProcessingTools.ExternalProcesses" href="#ParallelProcessingTools.ExternalProcesses"><code>ParallelProcessingTools.ExternalProcesses</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">ParallelProcessingTools.ExternalProcesses(;
    nprocs::Integer = ...
)</code></pre><p>Add worker processes by starting them externally.</p><p>Will log (via <code>@info</code>) a worker start command and then wait for the workers to connect. The user is responsible for starting the specified number of workers externally using that start command.</p><p>Example:</p><pre><code class="language-julia hljs">mode = ExternalProcesses(nprocs = 4)
addworkers(mode)</code></pre><p>The user now has to start 4 Julia worker processes externally using the logged start command. This start command can also be retrieved via <a href="#ParallelProcessingTools.worker_start_command"><code>worker_start_command(mode)</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/oschulz/ParallelProcessingTools.jl/blob/a57f4d1a8fa601295f82851ae42b368ac94d15b2/src/addworkers.jl#L429-L450">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ParallelProcessingTools.LocalProcesses" href="#ParallelProcessingTools.LocalProcesses"><code>ParallelProcessingTools.LocalProcesses</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">LocalProcesses(;
    nprocs::Integer = 1
)</code></pre><p>Mode to add <code>nprocs</code> worker processes on the current host.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/oschulz/ParallelProcessingTools.jl/blob/a57f4d1a8fa601295f82851ae42b368ac94d15b2/src/addworkers.jl#L190-L196">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ParallelProcessingTools.SlurmRun" href="#ParallelProcessingTools.SlurmRun"><code>ParallelProcessingTools.SlurmRun</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">SlurmRun(;
    slurm_flags::Cmd = {defaults}
    julia_flags::Cmd = {defaults}
    dir = pwd()
    user_start::Bool = false
    timeout::Real = 60
)</code></pre><p>Mode to add worker processes via SLURM <code>srun</code>.</p><p><code>srun</code> and Julia worker <code>julia</code> command line flags are inferred from SLURM environment variables (e.g. when inside of an <code>salloc</code> or batch job), as well as <code>slurm_flags</code> and <code>julia_flags</code>.</p><p>Workers are started with current directory set to <code>dir</code>.</p><p>Example:</p><pre><code class="language-julia hljs">mode = SlurmRun(slurm_flags = `--ntasks=4 --cpus-per-task=8 --mem-per-cpu=8G`)
addworkers(mode)</code></pre><p>If <code>user_start</code> is <code>true</code>, then the SLURM srun-command will not be run automatically, instead it will be logged via <code>@info</code> and the user is responsible for running it. This srun-command can also be retrieved via <a href="#ParallelProcessingTools.worker_start_command"><code>worker_start_command(mode)</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/oschulz/ParallelProcessingTools.jl/blob/a57f4d1a8fa601295f82851ae42b368ac94d15b2/src/slurm.jl#L3-L31">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ParallelProcessingTools.ThreadLocal" href="#ParallelProcessingTools.ThreadLocal"><code>ParallelProcessingTools.ThreadLocal</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">ThreadLocal{T} &lt;: AbstractThreadLocal{T}</code></pre><p>Represents a thread-local value. See <a href="#ParallelProcessingTools.AbstractThreadLocal"><code>AbstractThreadLocal</code></a> for the API.</p><p>Constructors:</p><pre><code class="language-julia hljs">ThreadLocal{T}() where {T}
ThreadLocal(value::T) where {T}
ThreadLocal{T}(f::Base.Callable) where {T}</code></pre><p>Examples:</p><pre><code class="language-julia hljs">tlvalue = ThreadLocal(0)
@onthreads allthreads() tlvalue[] = Base.Threads.threadid()
getallvalues(tlvalue) == allthreads()</code></pre><pre><code class="language-julia hljs">rand_value_on_each_thread = ThreadLocal{Float64}(rand)
all(x -&gt; 0 &lt; x &lt; 1, getallvalues(rand_value_on_each_thread))</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/oschulz/ParallelProcessingTools.jl/blob/a57f4d1a8fa601295f82851ae42b368ac94d15b2/src/threadlocal.jl#L51-L77">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ParallelProcessingTools.@always_everywhere-Tuple{Any}" href="#ParallelProcessingTools.@always_everywhere-Tuple{Any}"><code>ParallelProcessingTools.@always_everywhere</code></a> — <span class="docstring-category">Macro</span></header><section><div><pre><code class="language-julia hljs">always_everywhere(expr)</code></pre><p>Runs <code>expr</code> on all current Julia processes, but also all future Julia processes added via <a href="#ParallelProcessingTools.addworkers"><code>addworkers</code></a>).</p><p>Similar to <code>Distributed.everywhere</code>, but also stores <code>expr</code> so that <code>addworkers</code> can execute it automatically on new worker processes.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/oschulz/ParallelProcessingTools.jl/blob/a57f4d1a8fa601295f82851ae42b368ac94d15b2/src/addworkers.jl#L10-L18">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ParallelProcessingTools.@critical-Tuple{Any}" href="#ParallelProcessingTools.@critical-Tuple{Any}"><code>ParallelProcessingTools.@critical</code></a> — <span class="docstring-category">Macro</span></header><section><div><pre><code class="language-julia hljs">@critical expr</code></pre><p>Mark code in <code>expr</code> as a critical section. Code in critical sections will never be executed in parallel (via multithreading) to any other critical section.</p><p><code>@critical</code> is very useful to mark non-threadsafe code.</p><p>Example:</p><pre><code class="language-julia hljs">@onthreads allthreads() begin
    @critical @info Base.Threads.threadid()
end

Without `@critical`, the above will typically crash Julia.</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/oschulz/ParallelProcessingTools.jl/blob/a57f4d1a8fa601295f82851ae42b368ac94d15b2/src/threadsafe.jl#L68-L86">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ParallelProcessingTools.@mt_out_of_order-Tuple{Any}" href="#ParallelProcessingTools.@mt_out_of_order-Tuple{Any}"><code>ParallelProcessingTools.@mt_out_of_order</code></a> — <span class="docstring-category">Macro</span></header><section><div><pre><code class="language-julia hljs">@mt_out_of_order begin expr... end</code></pre><p>Runs all top-level expressions in <code>begin expr... end</code> on parallel multi-threaded tasks.</p><p>Example:</p><p>``` @mt<em>out</em>of_order begin     a = foo()     bar()     c = baz() end</p><p>will run <code>a = foo()</code>, <code>bar()</code> and <code>c = baz()</code> in parallel and in arbitrary order, results of assignments will appear in the outside scope.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/oschulz/ParallelProcessingTools.jl/blob/a57f4d1a8fa601295f82851ae42b368ac94d15b2/src/onthreads.jl#L110-L127">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ParallelProcessingTools.@onprocs-Tuple{Any, Any}" href="#ParallelProcessingTools.@onprocs-Tuple{Any, Any}"><code>ParallelProcessingTools.@onprocs</code></a> — <span class="docstring-category">Macro</span></header><section><div><pre><code class="language-julia hljs">@onprocs procsel expr</code></pre><p>Executes <code>expr</code> in parallel on all processes in <code>procsel</code>. Waits until all processes are done. Returns all results as a vector (or as a single scalar value, if <code>procsel</code> itself is a scalar).</p><p>Example:</p><pre><code class="language-julia hljs">using Distributed
addprocs(2)
workers() == @onprocs workers() myid()</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/oschulz/ParallelProcessingTools.jl/blob/a57f4d1a8fa601295f82851ae42b368ac94d15b2/src/onprocs.jl#L10-L24">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ParallelProcessingTools.@onthreads-Tuple{Any, Any}" href="#ParallelProcessingTools.@onthreads-Tuple{Any, Any}"><code>ParallelProcessingTools.@onthreads</code></a> — <span class="docstring-category">Macro</span></header><section><div><pre><code class="language-julia hljs">@onthreads threadsel expr</code></pre><p>Execute code in <code>expr</code> in parallel on the threads in <code>threadsel</code>.</p><p><code>threadsel</code> should be a single thread-ID or a range (or array) of thread-ids. If <code>threadsel == Base.Threads.threadid()</code>, <code>expr</code> is run on the current tread with only minimal overhead.</p><p>Example 1:</p><pre><code class="language-juliaexpr hljs">tlsum = ThreadLocal(0.0)
data = rand(100)
@onthreads allthreads() begin
    tlsum[] = sum(workpart(data, allthreads(), Base.Threads.threadid()))
end
sum(getallvalues(tlsum)) ≈ sum(data)</code></pre><p>Example 2:</p><pre><code class="language-julia hljs"># Assuming 4 threads:
tl = ThreadLocal(42)
threadsel = 2:3
@onthreads threadsel begin
    tl[] = Base.Threads.threadid()
end
getallvalues(tl)[threadsel] == [2, 3]
getallvalues(tl)[[1,4]] == [42, 42]</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/oschulz/ParallelProcessingTools.jl/blob/a57f4d1a8fa601295f82851ae42b368ac94d15b2/src/onthreads.jl#L61-L93">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ParallelProcessingTools.addworkers" href="#ParallelProcessingTools.addworkers"><code>ParallelProcessingTools.addworkers</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">addworkers(mode::ParallelProcessingTools.AddProcsMode)</code></pre><p>Add Julia worker processes for LEGEND data processing.</p><p>By default ensures that all workers processes use the same Julia project environment as the current process (requires that file systems paths are consistenst across compute hosts).</p><p>Use <a href="#ParallelProcessingTools.@always_everywhere-Tuple{Any}"><code>@always_everywhere</code></a> to run initialization code on all current processes and all future processes added via <code>addworkers</code>:</p><pre><code class="language-julia hljs">using Distributed, ParallelProcessingTools

@always_everywhere begin
    using SomePackage
    import SomeOtherPackage

    get_global_value() = 42
end

# ... some code ...

addworkers(LocalProcesses(nprocs = 4))

# `get_global_value` is available even though workers were added later:
remotecall_fetch(get_global_value, last(workers()))</code></pre><p>See also <a href="#ParallelProcessingTools.worker_resources-Tuple{}"><code>worker_resources()</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/oschulz/ParallelProcessingTools.jl/blob/a57f4d1a8fa601295f82851ae42b368ac94d15b2/src/addworkers.jl#L154-L185">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ParallelProcessingTools.allthreads-Tuple{}" href="#ParallelProcessingTools.allthreads-Tuple{}"><code>ParallelProcessingTools.allthreads</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">allthreads()</code></pre><p>Convencience function, returns an equivalent of <code>1:Base.Threads.nthreads()</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/oschulz/ParallelProcessingTools.jl/blob/a57f4d1a8fa601295f82851ae42b368ac94d15b2/src/onthreads.jl#L52-L56">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ParallelProcessingTools.default_elastic_manager" href="#ParallelProcessingTools.default_elastic_manager"><code>ParallelProcessingTools.default_elastic_manager</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">ParallelProcessingTools.default_elastic_manager()
ParallelProcessingTools.default_elastic_manager(manager::ClusterManagers.ElasticManager)</code></pre><p>Get or set the default elastic cluster manager.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/oschulz/ParallelProcessingTools.jl/blob/a57f4d1a8fa601295f82851ae42b368ac94d15b2/src/addworkers.jl#L256-L261">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ParallelProcessingTools.elastic_addprocs_timeout" href="#ParallelProcessingTools.elastic_addprocs_timeout"><code>ParallelProcessingTools.elastic_addprocs_timeout</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">ParallelProcessingTools.elastic_addprocs_timeout(mode::ElasticAddProcsMode)</code></pre><p>Get the timeout in seconds for waiting for worker processes to connect.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/oschulz/ParallelProcessingTools.jl/blob/a57f4d1a8fa601295f82851ae42b368ac94d15b2/src/addworkers.jl#L349-L353">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ParallelProcessingTools.elastic_localworker_startcmd-Tuple{Distributed.ClusterManager}" href="#ParallelProcessingTools.elastic_localworker_startcmd-Tuple{Distributed.ClusterManager}"><code>ParallelProcessingTools.elastic_localworker_startcmd</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">ParallelProcessingTools.elastic_localworker_startcmd(
    manager::Distributed.ClusterManager;
    julia_cmd::Cmd = _default_julia_cmd(),
    julia_flags::Cmd = _default_julia_flags(),
    julia_project::AbstractString = _default_julia_project()
)::Cmd</code></pre><p>Return the system command required to start a Julia worker process, that will connect to <code>manager</code>, on the current host.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/oschulz/ParallelProcessingTools.jl/blob/a57f4d1a8fa601295f82851ae42b368ac94d15b2/src/addworkers.jl#L325-L335">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ParallelProcessingTools.getallvalues" href="#ParallelProcessingTools.getallvalues"><code>ParallelProcessingTools.getallvalues</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">getallvalues(v::AbstractThreadLocal{T})::AbstractVector{T}</code></pre><p>Access the all values (one for each thread) of a thread-local value as a vector. Can only be called in single-threaded code sections.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/oschulz/ParallelProcessingTools.jl/blob/a57f4d1a8fa601295f82851ae42b368ac94d15b2/src/threadlocal.jl#L34-L39">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ParallelProcessingTools.getlocalvalue" href="#ParallelProcessingTools.getlocalvalue"><code>ParallelProcessingTools.getlocalvalue</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">getlocalvalue(x::Any) = x
getlocalvalue(x::ThreadLocal) = x[]</code></pre><p>Access plain values and thread-local values in a unified fashion.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/oschulz/ParallelProcessingTools.jl/blob/a57f4d1a8fa601295f82851ae42b368ac94d15b2/src/threadlocal.jl#L24-L29">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ParallelProcessingTools.pinthreads_auto-Tuple{}" href="#ParallelProcessingTools.pinthreads_auto-Tuple{}"><code>ParallelProcessingTools.pinthreads_auto</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">pinthreads_auto()</code></pre><p>Use default thread-pinning strategy for the current Julia process.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/oschulz/ParallelProcessingTools.jl/blob/a57f4d1a8fa601295f82851ae42b368ac94d15b2/src/addworkers.jl#L49-L53">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ParallelProcessingTools.pinthreads_distributed-Tuple{AbstractVector{&lt;:Integer}}" href="#ParallelProcessingTools.pinthreads_distributed-Tuple{AbstractVector{&lt;:Integer}}"><code>ParallelProcessingTools.pinthreads_distributed</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">ParallelProcessingTools.pinthreads_distributed(procs::AbstractVector{&lt;:Integer} = Distrib)</code></pre><p>Use default thread-pinning strategy on all Julia processes processes <code>procs</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/oschulz/ParallelProcessingTools.jl/blob/a57f4d1a8fa601295f82851ae42b368ac94d15b2/src/addworkers.jl#L71-L75">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ParallelProcessingTools.shutdown_workers_atexit-Tuple{}" href="#ParallelProcessingTools.shutdown_workers_atexit-Tuple{}"><code>ParallelProcessingTools.shutdown_workers_atexit</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">ParallelProcessingTools.shutdown_workers_atexit()</code></pre><p>Ensure worker processes are shut down when Julia exits.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/oschulz/ParallelProcessingTools.jl/blob/a57f4d1a8fa601295f82851ae42b368ac94d15b2/src/addworkers.jl#L93-L97">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ParallelProcessingTools.start_elastic_workers" href="#ParallelProcessingTools.start_elastic_workers"><code>ParallelProcessingTools.start_elastic_workers</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">ParallelProcessingTools.start_elastic_workers(mode::ElasticAddProcsMode, manager::ClusterManagers.ElasticManager)::Int</code></pre><p>Spawn worker processes as specified by <code>mode</code> and return the number of expected additional workers.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/oschulz/ParallelProcessingTools.jl/blob/a57f4d1a8fa601295f82851ae42b368ac94d15b2/src/addworkers.jl#L359-L364">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ParallelProcessingTools.worker_init_code" href="#ParallelProcessingTools.worker_init_code"><code>ParallelProcessingTools.worker_init_code</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">ParallelProcessingTools.worker_init_code(::AddProcsMode)::Expr</code></pre><p>Get a Julia code expression to run on new worker processes even before running <a href="#ParallelProcessingTools.@always_everywhere-Tuple{Any}"><code>@always_everywhere</code></a> code on them.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/oschulz/ParallelProcessingTools.jl/blob/a57f4d1a8fa601295f82851ae42b368ac94d15b2/src/addworkers.jl#L143-L148">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ParallelProcessingTools.worker_resources-Tuple{}" href="#ParallelProcessingTools.worker_resources-Tuple{}"><code>ParallelProcessingTools.worker_resources</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">worker_resources</code></pre><p>Get the distributed Julia process resources currently available.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/oschulz/ParallelProcessingTools.jl/blob/a57f4d1a8fa601295f82851ae42b368ac94d15b2/src/addworkers.jl#L103-L107">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ParallelProcessingTools.worker_start_command" href="#ParallelProcessingTools.worker_start_command"><code>ParallelProcessingTools.worker_start_command</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">ParallelProcessingTools.worker_start_command(
    mode::ElasticAddProcsMode,
    manager::ClusterManagers.ElasticManager = ParallelProcessingTools.default_elastic_manager()
)::Tuple{Cmd,Integer}</code></pre><p>Return the system command to start worker processes as well as the number of workers to start.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/oschulz/ParallelProcessingTools.jl/blob/a57f4d1a8fa601295f82851ae42b368ac94d15b2/src/addworkers.jl#L297-L305">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ParallelProcessingTools.workpart" href="#ParallelProcessingTools.workpart"><code>ParallelProcessingTools.workpart</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">workpart(data::AbstractArray, workersel::AbstractVector{W}, current_worker::W) where {W}</code></pre><p>Get the part of <code>data</code> that the execution unit <code>current_worker</code> is responsible for. Implies a partition of <code>data</code> across the workers listed in <code>workersel</code>.</p><p>For generic <code>data</code> arrays, <code>workpart</code> will return a view. If <code>data</code> is a <code>Range</code> (e.g. indices to be processed), a sub-range will be returned.</p><p>Type <code>W</code> will typically be <code>Int</code> and <code>workersel</code> will usually be a range/array of thread/process IDs.</p><p>Note: <code>workersel</code> is required to be sorted in ascending order and to contain no duplicate entries.</p><p>Examples:</p><pre><code class="language-julia hljs">using Distributed, Base.Threads
A = rand(100)
# ...
sub_A = workpart(A, workers(), myid())
# ...
idxs = workpart(eachindex(sub_A), allthreads(), threadid())
for i in idxs
    # ...
end</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/oschulz/ParallelProcessingTools.jl/blob/a57f4d1a8fa601295f82851ae42b368ac94d15b2/src/workpartition.jl#L62-L91">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Home</a><a class="docs-footer-nextpage" href="../LICENSE/">LICENSE »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.4.0 on <span class="colophon-date" title="Wednesday 24 April 2024 03:24">Wednesday 24 April 2024</span>. Using Julia version 1.10.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
